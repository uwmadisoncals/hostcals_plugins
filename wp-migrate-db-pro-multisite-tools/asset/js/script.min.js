var wpmdb=wpmdb||{};wpmdb.mediaFiles={remote_media_files_unavailable:!1},function(a,b){function c(){return"1"===r.attr("data-available")&&r.is(":checked")?!0:!1}function d(){a.wpmdb.do_action("wpmdb_enable_table_migration_options"),s.hide()}function e(){s.show()}function f(){return"false"===wpmdb_data.is_multisite||"savefile"!==wpmdb_migration_type()?(d(),void q.hide()):(c()?(e(),j()):d(),void q.show())}function g(){""===t.val()?u.hide():u.show()}function h(){var b=c();a.wpmdb.do_action("wpmdbmst_subsite_export_changed",b)}function i(){var a={};if(c()){var b=t.find("option:selected").val();""===b?a=!1:(a.blog_id=b,a.domain_and_path=t.find("option:selected").text())}return a}function j(){var b=i();a.wpmdb.do_action("wpmdbmst_selected_subsite_changed",b)}function k(){a.wpmdb.do_action("wpmdb_refresh_table_selects"),"savefile"===wpmdb_migration_type()&&a.wpmdb.do_action("wpmdb_update_push_table_select"),c()?(a.wpmdb.do_action("wpmdb_disable_table_migration_options"),w&&a.wpmdb.do_action("wpmdb_select_all_tables")):a.wpmdb.do_action("wpmdb_enable_table_migration_options")}function l(b){var c=x;void 0!==b&&(void 0!==b.domain_and_path&&(c="//"+b.domain_and_path),!0===y?a('.replace-row.pin .replace-right-col input[type="text"]').val(c):a('.replace-row.pin .old-replace-col input[type="text"]').val(c))}function m(a,c){var d=i();if(void 0!==d.blog_id){if(!(1<d.blog_id)){var e=b.preg_quote(c),f=new RegExp(a+"([0-9]+)_","i"),g=f.exec(e);return null==g}a=a+d.blog_id+"_";var h=c.toLowerCase().indexOf(a.toLowerCase());if(0===h)return!0}return!1}function n(d,e){if("false"===wpmdb_data.is_multisite||"savefile"!==wpmdb_migration_type())return d;if(c()){if(!1===i())return!0;if(e.substr(0,z.length)!==z)return!0;if(b.table_is(z,"users",e)||b.table_is(z,"usermeta",e))return d;var f=["blog_versions","blogs","registration_log","signups","site","sitemeta"];a.each(f,function(a,c){b.table_is(z,c,e)&&(d=!0)}),!1===m(z,e)&&(d=!0)}return d}function o(a){var c=b.preg_quote(a),d=new RegExp("[^a-z0-9_]","i"),e=d.exec(c);return null==e}function p(a){if("false"===wpmdb_data.is_multisite||"savefile"!==wpmdb_migration_type()||!1===c())return a;var b=v.val();return!1===i()?(alert(wpmdbmst_strings.please_select_a_subsite),a=!1):0===b.trim().length?(alert(wpmdbmst_strings.please_enter_a_prefix),a=!1):!1===o(b)&&(alert(wpmdbmst_strings.new_prefix_contents),a=!1),a}var q=a(".multisite-tools-options"),r=a("#multisite-subsite-export"),s=a(".multisite-tools-options .expandable-content"),t=a("#select-subsite"),u=a(".new-prefix-field"),v=a("#new-prefix"),w=!1,x=null,y=!1,z=a(".table-select-wrap .table-prefix").text();a.wpmdb.add_action("move_connection_info_box",function(b){z=a(".table-select-wrap .table-prefix").text(),null===x&&(x=a.wpmdb.apply_filters("wpmdb_base_old_url")),"undefined"!=typeof b.migration_type&&"undefined"!=typeof b.last_migration_type&&("savefile"===b.migration_type?"pull"===b.last_migration_type&&(y=!0):"savefile"===b.last_migration_type&&a('.replace-row.pin .old-replace-col input[type="text"]').val(x)),f(),wpmdb_toggle_migration_action_text(),a.wpmdb.do_action("wpmdb_refresh_table_selects"),y=!1}),a.wpmdb.add_action("wpmdbmst_subsite_export_changed",j),a.wpmdb.add_action("wpmdbmst_selected_subsite_changed",k),a.wpmdb.add_action("wpmdbmst_selected_subsite_changed",l),a.wpmdb.add_action("wpmdbmst_selected_subsite_changed",g),a.wpmdb.add_filter("wpmdb_exclude_table",n),a.wpmdb.add_filter("wpmdb_migration_profile_ready",p),a(document).ready(function(){a("body").on("change","#multisite-subsite-export",function(){h()}),a("body").on("change","#select-subsite",function(){j()}),f(),w=!0})}(jQuery,wpmdb);